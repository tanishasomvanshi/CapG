using System;
using System.IO;//File Input and output
using System.Collections.Generic;

namespace ExceptionHandlingEx
{
    class Program
    {
        static void Main()
        {
            try
            {
                Customer customer = new Customer();
                Console.WriteLine("Customer name: ");
                customer.CustomerName = Console.ReadLine();
                Console.WriteLine("Customer Mobile: ");
                customer.Mobile = Console.ReadLine();
                Console.WriteLine("Customer Age: ");
                customer.Age = Convert.ToInt32(Console.ReadLine());

                Console.WriteLine("Customer name:" + customer.CustomerName);
                Console.WriteLine("Customer Mobile:" + customer.Mobile);
                Console.WriteLine("Customer Age:" + customer.Age);
            }
            catch (Exception ex)
            {
                FileInfo fi = new FileInfo("c:\\CapG\\Log.txt");
                if(fi.Exists == false)
                {
                    fi.Create();
                }
                
                string content = $"\n\n{DateTime.Now} " +
                $"\nMessage: {ex.Message}" +
                $"\nStackTrace:{ex.StackTrace}" +
                $"\nInner Exception: {ex.InnerException?.Message}" +//conditional access operator "?"
                $"\nType:{ex.GetType().ToString()}";

                //FileStream fs = new FileStream("c:\\CapG\\Log.txt", FileMode.Append, FileAccess.Write);
                //byte[] barray = System.Text.Encoding.ASCII.GetBytes(content);
                //fs.Write(barray, 0, barray.Length);
                //fs.Close();

                StreamWriter sw = new StreamWriter(@"c:\CapG\Log.txt", true);
                sw.Write(content);
                sw.Close();

                //StreamReader sr = new StreamReader(@"c:\CapG\Log.txt", true);
                //Console.WriteLine(sr.ReadToEnd());
                //sr.Close();

                Console.WriteLine("Unexpected Error Occured, Please try again");
            }
            finally
            {
                Console.WriteLine("Thanks");
            }
            Console.ReadKey();
        }
    }
    class StringLengthException : Exception
    {
        public StringLengthException(string message): base(message) { }
    }
    class Customer
    {
        //fields
        private string _customerName;
        private string _mobile;
        private int _age;

        //properties
        public string CustomerName
        {
            set
            {
                if (value.Length <= 30)
                {
                    _customerName = value;
                }
                else
                {
                    throw new StringLengthException("Customer Name should be less than 30 characters");
                }
            }
            get
            {
                return _customerName;
            }
        }
        public string Mobile
        {
            set
            {
                _mobile = value;
            }
            get
            {
                return _mobile;
            }
        }
        public int Age
        {
            set
            {
                _age = value;
            }
            get
            {
                return _age;
            }
        }

    }
}
